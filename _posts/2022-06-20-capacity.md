---
date: 2022-06-20
layout: post
title:  "C# capacity"
description: "capacity"
image: /assets/img/posts/image/csharp.png
optimized_image: /assets/img/posts/image/csharp.png
category: C Sharp
tags:
  - C#
  - .NET
  - array
author: chanos
---
> [Git Source](https://github.com/chanos-dev/blogcode/tree/master/22-0620){:target="_blank"}

---

ì•ˆë…•í•˜ì„¸ìš”. <b>chanos</b>ì…ë‹ˆë‹¤. ğŸ˜‰

ì˜¤ëŠ˜ì€ collection ì‚¬ìš© ì‹œ ì†ì„±ì— ìˆëŠ” Capacityì— ëŒ€í•œ ê¸€ì…ë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•˜ëŠ” generic collectionì¸ List<T>ë¡œ ì„¤ëª…ì„ í•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  Listì˜ ë‚´ë¶€ êµ¬í˜„ì„ ì‚´í´ë³´ë©´ LinkedListê°€ ì•„ë‹Œ ArrayListë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

![list](/assets/img/posts/2022-06-20/list.png)

- LinkedList êµ¬í˜„ìœ¼ë¡œëœ collectionì€ c#ì—ì„œ [LinkedList\<T\>](https://docs.microsoft.com/ko-kr/dotnet/api/system.collections.generic.linkedlist-1?view=net-6.0)ë¡œ ì œê³µí•˜ê³  ìˆê³  Doubly Linked Listë¡œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.


ë‚´ë¶€ êµ¬í˜„ ìë£Œêµ¬ì¡°ë¥¼ ì„¤ëª…ë“œë¦° ì´ìœ ëŠ” Capacityì™€ ê´€ë ¨ìˆê¸° ë•Œë¬¸ì¸ë°ìš”.

ArrayListëŠ” ë™ì ë°°ì—´ì´ê¸° ë•Œë¬¸ì— elementê°€ add ë  ë•Œ ë§ˆë‹¤ í˜„ì¬ sizeë¥¼ ë¹„êµí•˜ì—¬ ë” ì´ìƒ add í•  ê³µê°„ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ê³µê°„ì„ í• ë‹¹í•˜ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ Capacityë¥¼ ì´ìš©í•˜ì—¬ ë©”ëª¨ë¦¬ ê³µê°„ì„ í• ë‹¹í•©ë‹ˆë‹¤.

ì‹¤ì œ add ë©”ì„œë“œ êµ¬í˜„ë¶€ë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![add](/assets/img/posts/2022-06-20/add.png)

![ensureCapacity](/assets/img/posts/2022-06-20/ensureCapacity.png)

![capacityGetter](/assets/img/posts/2022-06-20/capacityGetter.png)


í˜„ì¬ elementì˜ sizeê°€ ê½‰ ì°¼ì„ ê²½ìš° í˜„ì¬ size+1 ë§Œí¼ argumentë¡œ `EnsureCapacity` ë¥¼ í˜¸ì¶œ í•©ë‹ˆë‹¤.  

ì´ `EnsureCapacity`ì—ì„œëŠ” í˜„ì¬ _items.Lengthì˜ *2 ë§Œí¼ `Capacity`ì— ìƒˆë¡œì´ í• ë‹¹í•˜ëŠ”ë° ì´ ë•Œ ì£¼ì˜ì ì´ ìˆìŠµë‹ˆë‹¤.

Capacityì— í• ë‹¹í•  ê²½ìš° setterì—ì„œ ìƒˆë¡œìš´ arrayë¥¼ value(capacity)ë§Œí¼ í• ë‹¹í•˜ì—¬ ê¸°ì¡´ arrayë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. (*ë³µì‚¬ ë¹„ìš© ë°œìƒ) ë˜í•œ ìƒˆë¡œìš´ arrayê°€ í• ë‹¹ëê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ì°¸ì¡°í•œ arrayëŠ” GCê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ _items.Length *2 ë§Œí¼ í• ë‹¹í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ê³µê°„ì„ ì°¨ì§€í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ sizeê°€ maxì¸ ìƒíƒœì—ì„œ 1ê°œì˜ elementê°€ ì¶”ê°€ ëœ ê²½ìš° ì…ë‹ˆë‹¤.
  - defaultCapacityëŠ” 4 ì…ë‹ˆë‹¤.

```csharp
List<int> list = new List<int>();
list.AddRange(Enumerable.Range(1, 1 << 14));
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");
list.Add(-1);
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");

// output
capacity : 16384, count : 16384
capacity : 32768, count : 16385
```

---

capacityê°€ ì„¤ì •ì´ ì•ˆ ë˜ì–´ìˆìœ¼ë©´ default ê°’(=4)ì— ë”°ë¼ GC ë° array copy ë¹„ìš©, ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ê³µê°„ì´ ë°œìƒí•˜ê²Œ ë˜ëŠ”ë° ì´ capacityë¥¼ List ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ì¸ìë¡œ ë„˜ê²¨ì¤Œìœ¼ë¡œì¨ ì´ˆê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![constructor](/assets/img/posts/2022-06-20/constructor.png)

ê·¸ë ‡ê¸° ë•Œë¬¸ì— collectionì— ì¶”ê°€í•  ë°ì´í„°ì˜ ê°œìˆ˜ë¥¼ ë¯¸ë¦¬ ì•Œê³  ìˆëŠ” ê²½ìš° capacityë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ìŠµê´€ì„ ê°–ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

---

ë§ˆì§€ë§‰ìœ¼ë¡œ Capacity ì´ˆê¸°í™” ì—¬ë¶€ì— ë”°ë¥¸ GC ì„±ëŠ¥ í”„ë¡œíŒŒì¼ëŸ¬ì…ë‹ˆë‹¤.

```csharp
// Capacity (X)
List<int> list = new List<int>();
list.AddRange(Enumerable.Range(1, 1 << 26));
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");
list.Add(-1);
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");
```
![capacityX](/assets/img/posts/2022-06-20/capacityX.png)
```csharp
// Capacity (O)
List<int> list = new List<int>(1 << 26);            
list.AddRange(Enumerable.Range(1, 1 << 26));
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");
list.Add(-1);
Console.WriteLine($"capacity : {list.Capacity}, count : {list.Count}");
```
![capacityO](/assets/img/posts/2022-06-20/capacityO.png)

---

## Reference

[C# List\<T\>.Capacity](https://docs.microsoft.com/ko-kr/dotnet/api/system.collections.generic.list-1.capacity?view=net-6.0){:target="_blank"} 