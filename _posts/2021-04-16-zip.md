---
date: 2021-04-16
layout: post
title:  "C# ZipArchive"
description: "ZipArchive"
image: /assets/img/posts/image/csharp.png
optimized_image: /assets/img/posts/image/csharp.png
category: C Sharp
tags:
  - C#
  - .NET
  - zip
author: chanos
---
>[Git Source](https://github.com/chanos-dev/blogcode/tree/master/21-0416)

---

> <b> ZipArchive </b> ğŸ”

- ì°¸ì¡°
    - System.IO.Compression
    - System.IO.Compression.FileSystem

.Net Framework 4.5 ë¶€í„° ì••ì¶•ì— ëŒ€í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µì´ ë˜ë©° ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì œê³µë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ ZipArchiveë¥¼ ì‚¬ìš©í•œë‹¤.

- ì••ì¶•í•˜ê¸°
```c#
internal static void CreateZip(string contentsFolderPath, string saveZipPath, string extention = "*")
{
    if (!Directory.Exists(contentsFolderPath))
        throw new DirectoryNotFoundException($"The directory is not found. \n{contentsFolderPath}");

    if (!Directory.Exists(saveZipPath))
        Directory.CreateDirectory(Path.GetDirectoryName(saveZipPath));

    using (var fs = new FileStream(saveZipPath, FileMode.Create, FileAccess.ReadWrite))
    using (var za = new ZipArchive(fs, ZipArchiveMode.Create))
    {
        foreach (var filePath in Directory.EnumerateFiles(contentsFolderPath, $"*.{extention}", SearchOption.AllDirectories))
        {
            try
            { 
                za.CreateEntryFromFile(filePath, Path.GetFileName(filePath));
                                    
                //var entry = za.CreateEntry(Path.GetFileName(filePath));
                //using (var es = entry.Open())
                //using (var writer = new StreamWriter(es))
                //{
                //    writer.Write(File.ReadAllText(filePath));
                //}
            }
            catch
            {
                throw;
            }
        }
    }
}
```
    - ZipArchive í´ë˜ìŠ¤ì˜ í™•ì¥ì„¸ë¨¸ë“œì¸ CreateEntryFromFile ì •ì˜
    ```c# 
    // ìš”ì•½:
    //     ì••ì¶• zip ë³´ê´€ íŒŒì¼ì— ì¶”ê°€ í•˜ ì—¬ íŒŒì¼ì— ë³´ê´€ í•©ë‹ˆë‹¤.
    //
    // ë§¤ê°œ ë³€ìˆ˜:
    //   destination:
    //     Zip ë³´ê´€ íŒŒì¼ì„ ì¶”ê°€ í•©ë‹ˆë‹¤.
    //
    //   sourceFileName:
    //     ë³´ê´€ íŒŒì¼ì— ëŒ€ í•œ ê²½ë¡œì…ë‹ˆë‹¤. ìƒëŒ€ ê²½ë¡œ ë˜ëŠ” ì ˆëŒ€ ê²½ë¡œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒëŒ€ ê²½ë¡œëŠ” í˜„ì¬ ì‘ì—… ë””ë ‰í„°ë¦¬ì— ìƒëŒ€ì ìœ¼ë¡œ í•´ì„ë©ë‹ˆë‹¤.
    //
    //   entryName:
    //     Zip ë³´ê´€ íŒŒì¼ì—ì„œ ë§Œë“¤ í•­ëª©ì˜ ì´ë¦„ì…ë‹ˆë‹¤.
    //
    // ë°˜í™˜ ê°’:
    //     Zip ë³´ê´€ íŒŒì¼ì—ì„œ ìƒˆ í•­ëª©ì— ëŒ€ í•œ ë˜í¼.
    // 
    public static ZipArchiveEntry CreateEntryFromFile(this ZipArchive destination, string sourceFileName, string entryName);
    ```
    - sourceFileNameì˜ contentsë¥¼ ê°€ì ¸ì™€ entryNameì˜ ì´ë¦„ìœ¼ë¡œ ZipArchive entryì— ì¶”ê°€í•˜ëŠ” ê²ƒ ê°™ë‹¤. (ì£¼ì„ êµ¬ë¬¸ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ì¸ ë“¯ í•˜ë‹¤.)
    - ì£¼ì„êµ¬ë¬¸ì— ZipArchive í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œì¸ CreateEntryë¥¼ ì‚¬ìš©í•˜ê²Œë˜ë©´ `ë¹ˆ` í•­ëª©ì˜ entryê°€ ìƒì„±ë˜ë¯€ë¡œ í•´ë‹¹ entryì˜ streamì„ ê°€ì ¸ì™€ ì£¼ì„êµ¬ë¬¸ì²˜ëŸ¼ write í•´ì£¼ì–´ì•¼í•œë‹¤. (ì¶”ê°€ì ì¸ write ì—†ì´ í•´ë‹¹ íŒŒì¼ì˜ contentsë§Œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°ë©´ CreateEntryFromFileë¥¼ ì‚¬ìš©í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.)

- ì••ì¶• í•´ì œí•˜ê¸°
```c#
internal static void ExtractZip(string zipPath, string extractFolderPath)
{
    if (!File.Exists(zipPath))
        throw new FileNotFoundException($"The file is not found. \n{zipPath}");

    if (!Directory.Exists(extractFolderPath))
        Directory.CreateDirectory(Path.GetDirectoryName(extractFolderPath));

    using (var zipArchive = ZipFile.OpenRead(zipPath))
    {
        foreach (var zipArchiveEntry in zipArchive.Entries)
        {
            try
            {
                string folderPath = Path.GetDirectoryName(Path.Combine(extractFolderPath, zipArchiveEntry.FullName));

                if (!Directory.Exists(folderPath))
                    Directory.CreateDirectory(folderPath);

                zipArchiveEntry.ExtractToFile(Path.Combine(extractFolderPath, zipArchiveEntry.FullName));
            }
            catch
            {
                throw;
            }
        }
    }
}
```
    - ì••ì¶• í•´ì œëŠ” ê°„ë‹¨í•˜ê²Œ zipíŒŒì¼ì˜ ê²½ë¡œë¥¼ ZipArchiveë¡œ ì½ì–´ë“¤ì—¬ì„œ ì•ˆì— ìˆëŠ” í•­ëª©(entry)ë¥¼ ìˆœí™˜í•˜ë©° í™•ì¥ë©”ì„œë“œì¸ ExtractToFileë¥¼ ì´ìš©í•˜ì—¬ ì§€ì •ê²½ë¡œì— íŒŒì¼ì„ ì“´ë‹¤.

- ì‚¬ìš©
```c#
static void Main(string[] args)
{
    var contentsPath = @"Sample";
    var zipPath = Path.Combine(contentsPath, "sample.zip");

    Zip.CreateZip(contentsPath, zipPath, "txt");
    Zip.ExtractZip(zipPath, Path.Combine(contentsPath, "zipFolder"));
} 
```

- ìƒ˜í”Œ
![sample](/assets/img/posts/2021-04-16/sample.png)

- ê²°ê³¼
![result](/assets/img/posts/2021-04-16/result.png)

## Reference

[ZipArchive Class](https://docs.microsoft.com/ko-kr/dotnet/api/system.io.compression.ziparchive?redirectedfrom=MSDN&view=net-5.0){:target="_blank"}